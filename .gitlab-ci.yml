image:
  name: "tgcslearningtech/grade-nodejs"
  entrypoint: [""]

stages:
  - test

MochaTests:
  stage: test
  script:
    - /usr/local/bin/start-mongo.sh
    - npm install
    - npm run test-own
  timeout: "600"

sonarqube-check:
  image:
    name: "tgcslearningtech/webdev1-sonar-scanner"
    entrypoint: [""]
  stage: test
  script:
    - /usr/local/bin/start-mongo.sh
    - /usr/local/bin/node-link-packages.sh
    - npm install
    - npm run coverage
    - sonar-scanner.bat -D"sonar.projectKey=webdev1-autumn-2021-webdev1-group76" -D"sonar.sources=." -D"sonar.host.url=https://course-sonar.rd.tuni.fi" -D"sonar.login=744c00f4701edb0740f34865e4d88bc350e06069"
  only:
    refs:
      - master